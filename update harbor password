from harbor_client import Configuration, ApiClient, UsersApi

# Harbor configuration
HARBOR_URL = "https://your-harbor-instance.com"  # Replace with your Harbor URL
USERNAME = "admin"  # Replace with your admin username
CURRENT_PASSWORD = "old_password"  # Replace with the current admin password
NEW_PASSWORD = "new_password"  # Replace with the new password you want to set

# Configure API client
config = Configuration()
config.host = HARBOR_URL
config.username = USERNAME
config.password = CURRENT_PASSWORD
config.verify_ssl = False  # Set to True if Harbor uses a valid SSL certificate

# Initialize the API client
api_client = ApiClient(configuration=config)
users_api = UsersApi(api_client)

# Get the current user ID (admin)
try:
    current_user = users_api.get_current_user()
    user_id = current_user.user_id
    print(f"Current user ID: {user_id}")
except Exception as e:
    print(f"Failed to get current user: {e}")
    exit(1)

# Prepare the password update payload
password_update = {
    "old_password": CURRENT_PASSWORD,
    "new_password": NEW_PASSWORD
}

# Update the password
try:
    users_api.update_user_password(user_id, password_update)
    print("Password updated successfully!")
except Exception as e:
    print(f"Failed to update password: {e}")

#######################################################
PERMISSIONS = [
    RobotPermission(
        access=[
            Access(resource="/project/{}/repository".format(PROJECT_ID), action="pull"),  # Pull from source
            Access(resource="/project/{}/repository".format(PROJECT_ID), action="push"),  # Push to destination
            # Add more permissions if needed (e.g., for Helm charts)
            # Access(resource="/project/{}/helm-chart".format(PROJECT_ID), action="read"),
        ],
        kind="project",
        namespace=str(PROJECT_ID),
    )
]
##########################################################
import hvac

# OpenBao Configuration
OPENBAO_URL = "http://openbao-server:8200"  # Replace with your OpenBao URL
TOKEN = "s.your_openbao_token"             # Replace with a valid token (e.g., from env vars)

# Initialize the OpenBao client
client = hvac.Client(url=OPENBAO_URL, token=TOKEN)

# Verify connection
if not client.is_authenticated():
    raise Exception("OpenBao authentication failed!")

# Pull a secret (e.g., from KV engine v2)
SECRET_PATH = "secret/data/myapp"  # Path in OpenBao KV engine
try:
    secret_response = client.secrets.kv.v2.read_secret_version(path="myapp")  # Adjust path
    secret_data = secret_response["data"]["data"]
    print("Secret retrieved successfully:", secret_data)
except hvac.exceptions.InvalidPath:
    print("Secret path not found!")
except Exception as e:
    print(f"Error fetching secret: {e}")










###########################################
